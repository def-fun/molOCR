/*! MolView JavaScript Core build on 2020-07-30 */

var xhr,emptyImage="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",defaultMol2D=["C8H10N4O2","APtclcactv04181408232D 0   0.00000     0.00000"," "," 24 25  0  0  0  0  0  0  0  0999 V2000","    2.8660    0.5000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    2.0000    1.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    2.8660   -0.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    2.0000   -1.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321   -1.0000    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321   -2.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    4.5981   -0.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    5.5443   -0.8047    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    6.1279    0.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    5.5443    0.8047    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    5.8550    1.7553    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    4.5981    0.5000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321    1.0000    0.0000 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321    2.0000    0.0000 O   0  0  0  0  0  0  0  0  0  0  0  0","    2.3100    1.5369    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    1.4631    1.3100    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    1.6900    0.4631    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.1121   -2.0000    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.7321   -2.6200    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    4.3521   -2.0000    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    6.7479   -0.0000    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    6.4443    1.5626    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    6.0476    2.3446    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","    5.2656    1.9479    0.0000 H   0  0  0  0  0  0  0  0  0  0  0  0","  1  2  1  0  0  0  0","  1  3  1  0  0  0  0","  3  4  2  0  0  0  0","  3  5  1  0  0  0  0","  5  6  1  0  0  0  0","  5  7  1  0  0  0  0","  7  8  1  0  0  0  0","  8  9  2  0  0  0  0","  9 10  1  0  0  0  0"," 10 11  1  0  0  0  0"," 10 12  1  0  0  0  0","  7 12  2  0  0  0  0"," 12 13  1  0  0  0  0","  1 13  1  0  0  0  0"," 13 14  2  0  0  0  0","  2 15  1  0  0  0  0","  2 16  1  0  0  0  0","  2 17  1  0  0  0  0","  6 18  1  0  0  0  0","  6 19  1  0  0  0  0","  6 20  1  0  0  0  0","  9 21  1  0  0  0  0"," 11 22  1  0  0  0  0"," 11 23  1  0  0  0  0"," 11 24  1  0  0  0  0","M  END","$$$$"].join("\n"),defaultMol3D=["2519","  -OEChem-10201411173D",""," 24 25  0     0  0  0  0  0  0999 V2000","    0.4700    2.5688    0.0006 O   0  0  0  0  0  0  0  0  0  0  0  0","   -3.1271   -0.4436   -0.0003 O   0  0  0  0  0  0  0  0  0  0  0  0","   -0.9686   -1.3125    0.0000 N   0  0  0  0  0  0  0  0  0  0  0  0","    2.2182    0.1412   -0.0003 N   0  0  0  0  0  0  0  0  0  0  0  0","   -1.3477    1.0797   -0.0001 N   0  0  0  0  0  0  0  0  0  0  0  0","    1.4119   -1.9372    0.0002 N   0  0  0  0  0  0  0  0  0  0  0  0","    0.8579    0.2592   -0.0008 C   0  0  0  0  0  0  0  0  0  0  0  0","    0.3897   -1.0264   -0.0004 C   0  0  0  0  0  0  0  0  0  0  0  0","    0.0307    1.4220   -0.0006 C   0  0  0  0  0  0  0  0  0  0  0  0","   -1.9061   -0.2495   -0.0004 C   0  0  0  0  0  0  0  0  0  0  0  0","    2.5032   -1.1998    0.0003 C   0  0  0  0  0  0  0  0  0  0  0  0","   -1.4276   -2.6960    0.0008 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.1926    1.2061    0.0003 C   0  0  0  0  0  0  0  0  0  0  0  0","   -2.2969    2.1881    0.0007 C   0  0  0  0  0  0  0  0  0  0  0  0","    3.5163   -1.5787    0.0008 H   0  0  0  0  0  0  0  0  0  0  0  0","   -1.0451   -3.1973   -0.8937 H   0  0  0  0  0  0  0  0  0  0  0  0","   -2.5186   -2.7596    0.0011 H   0  0  0  0  0  0  0  0  0  0  0  0","   -1.0447   -3.1963    0.8957 H   0  0  0  0  0  0  0  0  0  0  0  0","    4.1992    0.7801    0.0002 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.0468    1.8092   -0.8992 H   0  0  0  0  0  0  0  0  0  0  0  0","    3.0466    1.8083    0.9004 H   0  0  0  0  0  0  0  0  0  0  0  0","   -1.8087    3.1651   -0.0003 H   0  0  0  0  0  0  0  0  0  0  0  0","   -2.9322    2.1027    0.8881 H   0  0  0  0  0  0  0  0  0  0  0  0","   -2.9346    2.1021   -0.8849 H   0  0  0  0  0  0  0  0  0  0  0  0","  1  9  2  0  0  0  0","  2 10  2  0  0  0  0","  3  8  1  0  0  0  0","  3 10  1  0  0  0  0","  3 12  1  0  0  0  0","  4  7  1  0  0  0  0","  4 11  1  0  0  0  0","  4 13  1  0  0  0  0","  5  9  1  0  0  0  0","  5 10  1  0  0  0  0","  5 14  1  0  0  0  0","  6  8  1  0  0  0  0","  6 11  2  0  0  0  0","  7  8  2  0  0  0  0","  7  9  1  0  0  0  0"," 11 15  1  0  0  0  0"," 12 16  1  0  0  0  0"," 12 17  1  0  0  0  0"," 12 18  1  0  0  0  0"," 13 19  1  0  0  0  0"," 13 20  1  0  0  0  0"," 13 21  1  0  0  0  0"," 14 22  1  0  0  0  0"," 14 23  1  0  0  0  0"," 14 24  1  0  0  0  0","M  END","> <PUBCHEM_COMPOUND_CID>","2519","","> <PUBCHEM_CONFORMER_RMSD>","0.4","","> <PUBCHEM_CONFORMER_DIVERSEORDER>","1","","> <PUBCHEM_MMFF94_PARTIAL_CHARGES>","15","1 -0.57","10 0.69","11 0.04","12 0.3","13 0.26","14 0.3","15 0.15","2 -0.57","3 -0.42","4 0.05","5 -0.42","6 -0.57","7 -0.24","8 0.29","9 0.71","","> <PUBCHEM_EFFECTIVE_ROTOR_COUNT>","0","","> <PUBCHEM_PHARMACOPHORE_FEATURES>","5","1 1 acceptor","1 2 acceptor","3 4 6 11 cation","5 4 6 7 8 11 rings","6 3 5 7 8 9 10 rings","","> <PUBCHEM_HEAVY_ATOM_COUNT>","14","","> <PUBCHEM_ATOM_DEF_STEREO_COUNT>","0","","> <PUBCHEM_ATOM_UDEF_STEREO_COUNT>","0","","> <PUBCHEM_BOND_DEF_STEREO_COUNT>","0","","> <PUBCHEM_BOND_UDEF_STEREO_COUNT>","0","","> <PUBCHEM_ISOTOPIC_ATOM_COUNT>","0","","> <PUBCHEM_COMPONENT_COUNT>","1","","> <PUBCHEM_CACTVS_TAUTO_COUNT>","1","","> <PUBCHEM_CONFORMER_ID>","000009D700000001","","> <PUBCHEM_MMFF94_ENERGY>","22.901","","> <PUBCHEM_FEATURE_SELFOVERLAP>","25.487","","> <PUBCHEM_SHAPE_FINGERPRINT>","10967382 1 18338799025773621285","11132069 177 18339075025094499008","12524768 44 18342463625094026902","13140716 1 17978511158789908153","16945 1 18338517550775811621","193761 8 15816500986559935910","20588541 1 18339082691204868851","21501502 16 18338796715286957384","22802520 49 18128840606503503494","2334 1 18338516344016692929","23402539 116 18270382932679789735","23552423 10 18262240993325675966","23559900 14 18199193898169584358","241688 4 18266458702623303353","2748010 2 18266180539182415717","5084963 1 17698433339235542986","528886 8 18267580380709240570","53812653 166 18198902694142226312","66348 1 18339079396917369615","","> <PUBCHEM_SHAPE_MULTIPOLES>","256.45","4.01","2.83","0.58","0.71","0.08","0","-0.48","0","-0.81","0","0.01","0","0","","> <PUBCHEM_SHAPE_SELFOVERLAP>","550.88","","> <PUBCHEM_SHAPE_VOLUME>","143.9","","> <PUBCHEM_COORDINATE_TYPE>","2","5","10","","$$$$",""].join("\n"),ChemIdentifiers={regex:{formula:/^((?:[A-Z][a-z]?)+[\d,.]*)*/},isFormula:function(e){return this.regex.formula.exec(e)[0]===e}};function ucfirst(e){return void 0===e?e:e.charAt(0).toUpperCase()+e.slice(1)}function humanize(e){return void 0===e?e:e.replace(/(\b[A-Z]+\b)/g,function(e){return e.toLowerCase()})}function formatMFormula(e){return e?e.replace(/[a-zA-Z0-9.,]+/g,function(e){return ChemIdentifiers.isFormula(e)?e.replace(/[\d,.]*/g,"<sub>$&</sub>"):e}):void 0}function formatHTMLLinks(e){return e.replace(/(http|https):\/\/[^\s]+/g,function(e){return'<a class="link" href="'+e+'" target="_blank">'+e+"</a>"})}function isTouchDevice(){return!!("ontouchstart"in window)||!!("onmsgesturechange"in window)&&!!window.navigator.maxTouchPoints}function getQuery(){if(""===location.search)return{};var e=location.search.slice(1).split("&"),t={};return e.forEach(function(e){e=e.split(/=(.+)?/),t[e[0]]=decodeURIComponent(e[1]||"")}),t}function oneOf(e,t){return-1!==t.indexOf(e)}function specialEncodeURIComponent(e){return e.replace(/&/g,"%26").replace(/#/g,"%23")}function dataURItoBlob(e){try{for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(t.length),o=new Uint8Array(s),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);var n=new DataView(s);return new Blob([n],{type:i})}catch(e){return console.error(e),null}}function openDataURI(e){var t=dataURItoBlob(e),i=window.URL||window.webkitURL||void 0;null!==t&&void 0!==i?window.open(i.createObjectURL(t)):window.open(e)}function AJAX(i){return i.primary&&void 0!==xhr&&xhr.abort(),void 0!==i.defaultError&&(i.error=function(e,t){"error"===t&&i.defaultError(e.status)}),i.primary?xhr=$.ajax(i):$.ajax(i)}function similar_text(e,t,i){if(null===e||null===t||void 0===e||void 0===t)return 0;for(var s,o,r,n=0,a=0,l=0,c=(e+="").length,d=(t+="").length,l=0,u=0;u<c;u++)for(s=0;s<d;s++){for(o=0;u+o<c&&s+o<d&&e.charAt(u+o)===t.charAt(s+o);o++);l<o&&(l=o,n=u,a=s)}return(r=l)&&(n&&a&&(r+=this.similar_text(e.substr(0,n),t.substr(0,a))),n+l<c&&a+l<d&&(r+=this.similar_text(e.substr(n+l,c-n-l),t.substr(a+l,d-a-l)))),i?200*r/(c+d):r}!function(a){a.fn.textfill=function(e){for(var t,i,s=e.maxFontPoints,o=this.children(),r=a(this).height(),n=a(this).width();o.css("font-size",s+"pt"),t=o.outerHeight(),i=o.outerWidth(),--s,(r<t||n<i)&&6<s;);return this}}(jQuery),jQuery,$.fn.sizeChanged=function(){return!(this.data("savedWidth")===this.width()&&this.data("savedHeight")===this.height())},$.fn.saveSize=function(){this.data("savedWidth",this.width()),this.data("savedHeight",this.height())};var Preferences={init:function(){void 0===Storage&&(window.localStorage={})},get:function(e,t,i){try{var s=window.localStorage[e+"."+t];return"true"===s||"false"!==s&&(s||i)}catch(e){return i}},set:function(e,t,i){window.localStorage[e+"."+t]=i}},Progress={value:0,steps:0,oldTime:0,animValue:0,valueAnimDev:.2,opacity:0,opacityAnimSpeed:1,ready:!0,animReady:!0,resetAnim:!1,canvas:void 0,ctx:void 0,init:function(){this.canvas=document.getElementById("progress-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.resize(),this.draw())},resize:function(){Progress.canvas&&(Progress.canvas.width=$(window).width(),Progress.canvas.height=3)},draw:function(e){var t;Progress.canvas&&(Progress.resetAnim&&(Progress.resetAnim=!1,Progress.animReady=!1,Progress.oldTime=e,Progress.animValue=0,Progress.opacity=1,Progress.ctx.clearRect(0,0,Progress.canvas.width,Progress.canvas.height)),Progress.animReady||(.1<(t=(e-Progress.oldTime)/1e3||.001)&&(t=.1),Progress.oldTime=e,Progress.animValue+=(Progress.value-Progress.animValue)/(Progress.valueAnimDev/t),Progress.animValue>Progress.value&&(Progress.animValue=Progress.value),Progress.ctx.beginPath(),Progress.ready?(Progress.opacity-=Progress.opacityAnimSpeed*t,Progress.ctx.clearRect(0,0,Progress.canvas.width,Progress.canvas.height),Progress.opacity<=0?Progress.animReady=!0:(Progress.ctx.fillStyle="rgba(255,0,0,"+Progress.opacity+")",Progress.ctx.fillRect(0,0,Progress.canvas.width*Progress.animValue,Progress.canvas.height))):(Progress.ctx.fillStyle="rgb(255,0,0)",Progress.ctx.fillRect(0,0,Progress.canvas.width*Progress.animValue,Progress.canvas.height))),requestAnimationFrame(Progress.draw))},reset:function(e,t){this.steps=e+1,this.value=0,this.increment(),this.ready=!1,t||(document.title=document.title.replace(/ \[loading\]/g,""),document.title+=" [loading]"),this.resetAnim=!0},increment:function(){this.value+=1/this.steps},complete:function(){this.value=1,this.ready=!0,document.title=document.title.replace(/ \[loading\]/g,"")}},Messages={cir_down:"The Chemical Identifier Resolver is offline, some functions might be unavailable.",cir_func_down:"This function is unavailable because the Chemical Identifier Resolver is offline.",crystal_2d_unreliable:"The structural formula might not fully represent the crystal structure",resolved_3d_unreliable:'The resolved 3D structure can sometimes be inaccurate <a href="http://blog.molview.org/2016/10/10/issues-in-3d-resolving/" target="_blank">Read more</a>',calculation_unreliable:"Calculation results can be inaccurate or wrong.",measurements_unreliable:"Measurement results can be inaccurate or wrong.",switch_engine:"Loading engine&hellip;",compound:"Loading compound&hellip;",macromolecule:"Loading macromolecule&hellip;",crystal:"Loading crystal&hellip;",crystal_structure:"Loading crystal structure&hellip;",search:"Searching&hellip;",clean:"Cleaning&hellip;",resolve:"Updating&hellip;",model_update:"Updating&hellip;",init_jmol:"Initializing Jmol&hellip;",jmol_calculation:"Calculation in progress&hellip;",no_webgl_support:Detector.getWebGLErrorMessage(),mobile_old_no_macromolecules:"Macromolecules cannot be viewed on your device",no_glmol_crystals:"You cannot view crystals using GLmol",glmol_and_jmol_only:"This feature is only available in GLmol and Jmol",glmol_only:"This feature is only available in GLmol",no_jmol_chain_type:"The current chain representation is not supported by Jmol",no_chemdoodle_chain_type:"The current chain representation is not supported by ChemDoodle",no_chemdoodle_chain_color:"The current chain representation is not supported by ChemDoodle",smiles_load_error:"Failed to load structure from sketcher",smiles_load_error_force:"Failed to load structure from sketcher",load_fail:"Failed to load structure from its database",search_fail:"The database did not return any records",search_notfound:"The database could not find any matches",structure_search_fail:"Structure search has failed",remote_noreach:"Remote database is not reachable",crystal_2d_fail:"Failed to resolve a 2D representation of this crystal structure",no_protein:"The current 3D model is not a protein",permDismiss:["crystal_2d_unreliable","resolved_3d_unreliable","calculation_unreliable","measurements_unreliable"],dontShowAgain:function(e){Preferences.set("messages",e,!0)},process:function(e,t){var i,s=!0;return"model_update"!==t||Messages.isEmpty()?(Messages.clear(),t&&""!==t&&Messages[t]&&""!==Messages[t]&&($("body").addClass("progress-cursor"),i=$("<div/>").addClass("message"),$("<div/>").addClass("message-text").html(Messages[t]).appendTo(i),i.appendTo($("#messages")))):s=!1,window.setTimeout(e,300),s},alert:function(e,t){var i,s;"no_canvas_support"!==e?($("body").removeClass("progress-cursor"),Preferences.get("messages",e,!1)||(i=$("<div/>").addClass("message alert-message"),s=$("<div/>").addClass("message-text").html(Messages[e]||e),t&&s.append('<span class="error-message">'+(t.message||t.detailMessage||t)+"</span>"),s.appendTo(i),$('<button class="message-close-btn">OK</button>').on(MolView.trigger,function(){$(this).parent().remove()}).appendTo(i),-1!==Messages.permDismiss.indexOf(e)&&$('<button class="message-close-btn">Don\'t show again</button>').on(MolView.trigger,function(){$(this).parent().remove(),Messages.dontShowAgain(e)}).appendTo(i),i.appendTo($("#messages"))),this.clear(),Progress.complete()):window.location=window.location.origin+window.location.pathname+"htmlCanvas"},clear:function(e){$("body").removeClass("progress-cursor"),$("#messages").children().each(function(){$(this).hasClass("alert-message")||$(this).remove()})},isEmpty:function(){return $("#messages").is(":empty")},size:function(){return $("#messages .message").length}},GLmolPlugin={ready:!1,view:void 0,currentModel:"",bondsCalculated:!1,init:function(e){return Detector.canvas?(this.view=new GLmol("glmol",!Detector.webgl,Model.pixelMult,Model.bg.hex),this.view.defineRepresentation=function(){var e=this.getAllAtoms();Model.displayBU&&""!==this.protein.biomtChains&&(e=this.getChain(e,this.protein.biomtChains));var t=this.getHetatms(e),i=this.removeSolvents(t),s=Model.chain,o=new THREE.Object3D;this.colorByAtom(e,{}),Model.isPDB()&&("ss"===s.color?this.colorByStructure(e,13369548,52428,13421772):"spectrum"===s.color?this.colorChainbow(e):"chain"===s.color?this.colorByChain(e,!0):"residue"===s.color?this.colorByResidue(e,GLmolAminoColors):"polarity"===s.color?this.colorByPolarity(e,13369344,13421772):"bfactor"===s.color&&this.colorByBFactor(e),"ribbon"===s.type?(this.drawCartoon(o,e,!1),this.drawCartoonNucleicAcid(o,e)):"cylinders"===s.type?(this.drawHelixAsCylinder(o,e,1.6),this.drawCartoonNucleicAcid(o,e)):"btube"===s.type?(this.drawMainchainTube(o,e,"CA"),this.drawMainchainTube(o,e,"O3'")):"ctrace"===s.type&&(this.drawMainchainCurve(o,e,this.curveWidth,"CA",1),this.drawMainchainCurve(o,e,this.curveWidth,"O3'",1)),s.bonds&&(Model.GLmol.bondsCalculated||(Model.GLmol.bondsCalculated=!0,this.calculateBonds()),this.drawBondsAsLine(o,e,this.lineWidth))),Model.displayBU&&Model.isPDB()||(this.canvasVDW=!1,this.canvasLine=!1,"balls"===Model.representation?(this.canvasAtomRadius=.4,this.canvasBondWidth=.3,this.drawBondsAsStick(this.modelGroup,i,this.cylinderRadius/2,5*this.cylinderRadius,!0,.3)):"stick"===Model.representation?(this.canvasAtomRadius=.3,this.canvasBondWidth=.6,this.drawBondsAsStick(this.modelGroup,i,this.cylinderRadius,this.cylinderRadius)):"vdw"===Model.representation?(this.canvasVDW=!0,this.canvasAtomRadius=.5,this.canvasBondWidth=.3,this.drawAtomsAsSphere(this.modelGroup,i,this.sphereRadius)):"wireframe"===Model.representation?(this.canvasAtomRadius=.2,this.canvasLine=!0,this.drawBondsAsStick(this.modelGroup,i,this.cylinderRadius/8,8*this.cylinderRadius,!0,.05)):"line"===Model.representation&&(this.canvasAtomRadius=0,this.canvasLine=!0,this.drawBondsAsLine(this.modelGroup,i,this.lineWidth))),Model.isPDB()&&(Model.displayBU&&this.drawSymmetryMates2(this.modelGroup,o,this.protein.biomtMatrices),this.modelGroup.add(o))},Model._setRenderEngine("GLmol"),this.ready=!0,e&&e(),!0):(Messages.alert("no_canvas_support"),!1)},resize:function(){this.view&&$("#glmol").sizeChanged()&&($("#glmol").saveSize(),this.view.resize())},reset:function(){this.view&&(this.view.zoom2D=30,this.view.zoomInto(this.view.getAllAtoms()),this.view.redraw())},setRepresentation:function(){this.view&&(this.view.rebuildScene(),this.view.redraw())},setBackground:function(e){this.view.setBackground(e),this.view.redraw()},loadMOL:function(e){this.currentModel!==e&&this.view&&(this.currentModel=e,this.view.loadSDF(e))},loadPDB:function(e){if(this.currentModel===e)return this.view.protein.appliedMatrix=void 0,void this.view.zoomInto(this.view.getAllAtoms());this.view&&(this.bondsCalculated=!1,this.currentModel=e,this.view.loadPDB(e))},setAssembly:function(){this.view&&(this.view.rebuildScene(),Model.displayBU||(this.view.protein.appliedMatrix=void 0),this.view.zoomInto(Model.GLmol.view.getAllAtoms()),this.view.redraw())},setChainColor:function(e){var t=Messages.process(function(){Model.GLmol.setRepresentation.call(Model.GLmol),t&&Messages.clear()},"glmol_update")},toDataURL:function(){if(this.view){this.view.setBackground(0,0),this.view.draw();var e="",e=this.view.webglFailed?document.getElementById("glmol").firstChild.toDataURL("image/png"):this.view.renderer.domElement.toDataURL("image/png");return this.view.setBackground(Model.bg.hex),this.view.redraw(),e}return""}},JmolScripts={basicSettings:"",select:{molecules:"select *; select remove protein or nucleic;",macromolecules:"select protein or nucleic;"},mol:{balls:"wireframe 0.09; spacefill 25%;",stick:"wireframe 0.4; spacefill 0;",vdw:"spacefill 100%;",wireframe:"wireframe 0.03; spacefill 0.08;",line:"wireframe on; spacefill off;"},pdb:{none:"wireframe only; wireframe off;",ribbon:"ribbon only;",ctrace:"backbone only;",bonds:"wireframe on;",ss:"color atoms cpk;color ribbon [xcccccc]; color backbone [xcccccc];select helix; color ribbon [xcc00cc]; color backbone [xcc00cc];select sheet; color ribbon [x00cccc]; color backbone [x00cccc];select nucleic; color ribbon red; color backbone red;",spectrum:"color atoms group; color ribbon group; color backbone group;",chain:"color atoms chain; color ribbon chain; color backbone chain;",residue:"color atoms amino; color ribbon amino; color backbone amino;",polarity:"color [xcccccc]; color ribbon [xcccccc]; select polar; color ribbon [xcc0000]; color [xcc0000];",bfactor:"color atoms cpk; color ribbons relativeTemperature; color backbone fixedTemperature;",hideSolvents:"display not solvent;"},resetLabels:"select *; hover off; color measures magenta; font measure 18;",clearMeasures:"measure off; measure delete;",clearMolecule:'isosurface off; echo ""; label ""; select formalCharge <> 0; label %C; select *; dipole bond delete; dipole molecular delete; color cpk;'},JSmolPlugin={ready:!1,readyCB:void 0,hq:!0,picking:"OFF",currentModel:"",init:function(e){if(void 0!==Jmol)return delete Jmol._tracker,Detector.canvas?(this.readyCB=e,Messages.process(function(){Jmol.setDocument(!1),Jmol.getApplet("JSmol",{width:$("#model").width(),height:$("#model").height(),debug:!1,showfrank:!1,disableJ2SLoadMonitor:!0,disableInitialConsole:!0,allowJavaScript:!0,use:"HTML5",j2sPath:MolView.JMOL_J2S_PATH,script:'unbind _setMeasure; unbind "MIDDLE DRAG" "_rotateZorZoom"; bind "MIDDLE DRAG" "_translate";frank off; set specular off;background '+Model.bg.jmol+"; color label "+Model.bg.jmol+";background echo "+Model.bg.jmol+"; color echo "+Model.bg.jmol+';set antialiasDisplay true; set disablePopupMenu true; set showunitcelldetails false;set hoverDelay 0.001; hover off; font measure 18; font echo 18 serif bold; set echo top left;set MessageCallback "Model.JSmol.MessageCallback";set MinimizationCallback "Model.JSmol.MinimizationCallback";',readyFunction:Model.JSmol.ReadyCallback.bind(Model.JSmol),console:"none"}),$("#jsmol").html(Jmol.getAppletHtml(JSmol))},"init_jmol"),!0):(Messages.alert("no_canvas_support"),!1)},ReadyCallback:function(){this.ready=!0,this.setQuality(this.hq),Model._setRenderEngine("JSmol"),Messages.clear(),this.readyCB&&this.readyCB()},MessageCallback:function(e,t){var i;-1<t.toLowerCase().indexOf("initial mmff e")&&-1<t.toLowerCase().indexOf("max steps = 0")&&(i=t.split(/ +/),Model.JSmol.print("Energy = "+i[5]+" kJ"))},MinimizationCallback:function(e,t){"done"===t&&(Model.JSmol._setQuality(Model.JSmol.hq),Messages.clear())},script:function(e){this.ready&&Jmol.script(JSmol,e)},scriptWaitOutput:function(e){this.ready&&Jmol.scriptWaitOutput(JSmol,e)},print:function(e){this.ready&&Model.JSmol.script('echo "'+e+'";')},resize:function(){this.ready&&$("#jsmol").sizeChanged()&&($("#jsmol").saveSize(),Jmol.resizeApplet(JSmol,[$("#model").width(),$("#model").height()]))},reset:function(){this.ready&&(Model.JSmol.clean(),Model.JSmol.scriptWaitOutput("reset;"),Model.isCIF()&&Model.JSmol.scriptWaitOutput("rotate best;"))},setRepresentation:function(){var e;this.ready&&(this.scriptWaitOutput(JmolScripts.select.molecules),this.scriptWaitOutput(JmolScripts.mol[Model.representation]),Model.isPDB()&&(oneOf(e=Model.chain.type,["ribbon","ctrace","none"])||(e="ribbon",Messages.alert("no_jmol_chain_type")),this.scriptWaitOutput(JmolScripts.select.macromolecules),this.scriptWaitOutput(JmolScripts.pdb[e]),Model.chain.bonds&&this.scriptWaitOutput(JmolScripts.pdb.bonds),this.scriptWaitOutput(JmolScripts.pdb[Model.chain.color]),this.scriptWaitOutput(JmolScripts.pdb.hideSolvents)),this.scriptWaitOutput(JmolScripts.resetLabels))},setBackground:function(e){this.ready&&Model.JSmol.scriptWaitOutput("\t\t\t\tbackground "+e+"; color label "+e+";\t\t\t\tbackground echo "+e+"; color echo "+e+";\t\t\t\tset echo top left; font echo 18 serif bold; refresh;")},loadMOL:function(e){return this.currentModel!==e&&(this.ready?(this.currentModel=e,this._setMeasure("OFF"),JSmol._loadMolData(e),this.setRepresentation(Model.representation),!0):void 0)},loadPDB:function(e){return this.currentModel!==e&&(this.ready?(this.currentModel=e,this._setMeasure("OFF"),this.scriptWaitOutput("set defaultLattice {0 0 0};"),this.scriptWaitOutput("set showUnitcell false;"),JSmol.__loadModel(e),this.setRepresentation(Model.representation),!0):void 0)},loadCIF:function(e,t){return this.currentModel!==e+t&&(this.ready?(this.currentModel=e+t,this._setMeasure("OFF"),t=t||[1,1,1],this.scriptWaitOutput("set defaultLattice {"+t.join(" ")+"};"),JSmol.__loadModel(e),this.scriptWaitOutput("set showUnitcell "+(1<t.reduce(function(e,t){return e*t})?"false":"true")),this.setRepresentation(Model.representation),this.scriptWaitOutput("rotate best;"),!0):void 0)},setQuality:function(e,t){$("#action-jmol-hq").removeClass("checked"),e&&$("#action-jmol-hq").addClass("checked"),this.hq=e,this._setMeasure("OFF",!0),this._setQuality(e,t)},_setQuality:function(e,t){this.scriptWaitOutput("set antialiasDisplay "+(e&&!t?"true":"false")+"; set platformSpeed "+(t&&e?2:e?4:1)+"; set ribbonBorder "+(e&&!t?"on":"off"))},safeCallback:function(e,t,i){Model.setRenderEngine("JSmol",function(){Messages.process(function(){e(),i||Messages.clear()},t)})},clean:function(){this.script(JmolScripts.clearMeasures),this.script(JmolScripts.clearMolecule),this.script(JmolScripts.resetLabels),this.setMeasure("OFF")},calculatePartialCharge:function(){var e;this.ready&&(0<parseFloat(""+Jmol.evaluate(JSmol,"{*}.partialcharge.max"))||(-1<(e=Jmol.getPropertyAsArray(JSmol,"moleculeInfo.mf")[0]).indexOf("H 1 F 1")&&this.scriptWaitOutput("{fluorine and connected(1,hydrogen)}.partialCharge = '-0.47';{hydrogen and connected(1,fluorine)}.partialCharge = '0.47';"),-1<e.indexOf("H 1 Cl 1")&&this.scriptWaitOutput("{chlorine and connected(1,hydrogen)}.partialCharge = '-0.46';{hydrogen and connected(1,chlorine)}.partialCharge = '0.46';"),-1<e.indexOf("H 1 Br 1")&&this.scriptWaitOutput("{bromine and connected(1,hydrogen)}.partialCharge = '-0.42';{hydrogen and connected(1,bromine)}.partialCharge = '0.42';"),-1<e.indexOf("H 1 I 1")&&this.scriptWaitOutput("{iodine and connected(1,hydrogen)}.partialCharge = '-0.37';{hydrogen and connected(1,iodine)}.partialCharge = '0.37';"),this.scriptWaitOutput("select *; calculate partialcharge;")))},loadMEPSurface:function(e){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("isosurface vdw resolution 0 color range -.07 .07 map mep "+(e?"translucent":"opaque")+";"),Model.JSmol.script(JmolScripts.resetLabels)},"jmol_calculation"))},displayCharge:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("font label 18; color label magenta; label %-8.4[partialcharge]; hover off;")},"jmol_calculation"))},displayDipoles:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("dipole bonds on; dipole calculate bonds; hover off;")},"jmol_calculation"))},displayNetDipole:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure("OFF"),Model.JSmol.calculatePartialCharge(),Model.JSmol.script("dipole molecular on; dipole calculate molecular; hover off;")},"jmol_calculation"))},calculateEnergyMinimization:function(){Model.isPDB()||(MolView.makeModelVisible(),Model.JSmol.safeCallback(function(){Model.JSmol.setQuality(Model.JSmol.hq,!0),Model.JSmol.script(JmolScripts.clearMolecule),Model.JSmol.script(JmolScripts.resetLabels),Model.JSmol.script("minimize;")},"jmol_calculation",!0))},setMeasure:function(e,t){this.picking!==e.toLowerCase()&&Model.JSmol.safeCallback(function(){Model.JSmol._setMeasure(e,t)})},_setMeasure:function(e,t){this.picking!==e.toLowerCase()&&(this.picking=e.toLowerCase(),$(".jmol-picking").removeClass("checked"),"off"===this.picking?(Model.JSmol.scriptWaitOutput("set picking off;"),t||Model.JSmol._setQuality(Model.JSmol.hq)):($("#action-jmol-measure-"+this.picking).addClass("checked"),Model.JSmol._setQuality(Model.JSmol.hq,!0),Model.JSmol.scriptWaitOutput("set picking off; set picking on; set pickingStyle MEASURE ON; set picking MEASURE "+e+";")))},toDataURL:function(){return this.ready?document.getElementById("JSmol_canvas2d").toDataURL("image/png"):""}},CDWPlugin={ready:!1,view:void 0,molecule:void 0,currentModel:"",init:function(e){if(void 0!==ChemDoodle)return Detector.webgl?(this.view=new ChemDoodle.TransformCanvas3D("chemdoodle-canvas",$("#model").width()*Model.pixelMult,$("#model").height()*Model.pixelMult),$("#chemdoodle-canvas").css({width:$("#model").width(),height:$("#model").height()}),this.view.specs.macromolecules_ribbonCartoonize=this.view.specs.proteins_ribbonCartoonize=!0,this.view.specs.backgroundColor=Model.bg.html,this.view.specs.crystals_unitCellColor=Model.fg.html,Model._setRenderEngine("CDW"),this.ready=!0,e&&e(),!0):(Messages.alert("no_webgl_support"),!1)},resize:function(){this.view&&$("#chemdoodle").sizeChanged()&&($("#chemdoodle").saveSize(),this.view.resize($("#model").width()*Model.pixelMult,$("#model").height()*Model.pixelMult),$("#chemdoodle-canvas").css({width:$("#model").width(),height:$("#model").height()}),void 0!==this.molecule&&this.view.loadMolecule(this.molecule))},reset:function(){this.view&&(this.view.rotationMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.view.repaint())},setRepresentation:function(){var e=Model.representation;"balls"===e?e="Ball and Stick":"stick"===e?e="Stick":"vdw"===e?e="van der Waals Spheres":"wireframe"===e?e="Wireframe":"line"===e&&(e="Line"),this.view.specs.set3DRepresentation(e),"Ball and Stick"===e&&(this.view.specs.bonds_cylinderDiameter_3D=.2),this.view.specs.backgroundColor=Model.bg.html,this.view.specs.crystals_unitCellColor=Model.fg.html,this.view.specs.bonds_useJMOLColors=!0,Model.isPDB()&&("ribbon"===Model.chain.type&&!Model.chain.bonds||Messages.alert("no_chemdoodle_chain_type"),"bfactor"===Model.chain.color&&Messages.alert("no_chemdoodle_chain_color"),this.view.specs.macro_colorByChain="chain"===Model.chain.color,"spectrum"===Model.chain.color?this.view.specs.proteins_residueColor="rainbow":"residue"===Model.chain.color?this.view.specs.proteins_residueColor="amino":"polarity"===Model.chain.color?this.view.specs.proteins_residueColor="polarity":this.view.specs.proteins_residueColor="none"),this.view.repaint()},setBackground:function(e,t,i){this.view.specs.backgroundColor=t,this.view.specs.crystals_unitCellColor=i,this.view.gl.clearColor(e[0]/255,e[1]/255,e[2]/255,1),this.view.repaint()},loadMOL:function(e){this.currentModel!==e&&this.view&&(this.currentModel=e,this.molecule=ChemDoodle.readMOL(e,1),this.view.specs.projectionPerspective_3D=!0,this.view.specs.compass_display=!1,this.view.loadMolecule(this.molecule))},loadPDB:function(e){this.currentModel!==e&&this.view&&(this.currentModel=e,this.molecule=ChemDoodle.readPDB(e),this.view.specs.projectionPerspective_3D=!0,this.view.specs.compass_display=!1,this.view.loadMolecule(this.molecule))},loadCIF:function(e,t){this.currentModel!==e+t&&this.view&&(this.currentModel=e+t,t=t||[1,1,1],this.view.specs.crystals_displayUnitCell=1===t.reduce(function(e,t){return e*t}),this.view.specs.projectionPerspective_3D=!1,this.view.specs.compass_display=!0,this.molecule=ChemDoodle.readCIF(e,t[0],t[1],t[2]),this.view.loadMolecule(this.molecule))},toDataURL:function(){if(this.view){this.view.gl.clearColor(0,0,0,0),this.view.repaint();var e=this.view.gl.canvas.toDataURL("image/png");return this.view.gl.clearColor(Model.bg.rgb[0]/255,Model.bg.rgb[1]/255,Model.bg.rgb[2]/255,1),e}return""}},Model={data:{mol:"",pdb:"",cif:"",current:"MOL"},representation:"balls",displayBU:!1,chain:{type:"ribbon",bonds:!1,color:"ss"},bg:{colorName:"black",hex:0,rgb:[0,0,0],jmol:"[0,0,0]",html:"rgb(0,0,0)"},fg:{html:"rgb(255,255,255)"},engine:void 0,GLmol:GLmolPlugin,JSmol:JSmolPlugin,CDW:CDWPlugin,pixelMult:1,init:function(e,t){if(this.pixelMult=MolView.devicePixelRatio,this.setBackground(Preferences.get("model","background","black")),!(this.GLmol&&this.JSmol&&this.CDW))throw new Error("Not all Model plugins are loaded");MolView.loadDefault&&(this.data.mol=defaultMol3D||""),this.setRenderEngine(t||"GLmol",e)},preloadQuery:function(e,t){var i=this;$.each(e,function(e,t){"mode"===e?oneOf(t,["balls","stick","vdw","wireframe","line"])&&($(".r-mode").removeClass("checked"),$("#action-model-"+t).addClass("checked"),i.representation=t):"chainType"===e?(oneOf(t,["ribbon","cylinders","btube","ctrace"])&&($(".chain-type").removeClass("checked"),$("#action-chain-type-"+t).addClass("checked"),i.chain.type=t),"bonds"===t&&($(".chain-type").removeClass("checked"),i.chain.type="none",i.chain.bonds=!0)):"chainBonds"===e?i.chain.bonds=!0:"chainColor"===e&&oneOf(t,["ss","spectrum","chain","residue","polarity","bfactor"])&&($(".chain-color").removeClass("checked"),$("#action-chain-color-"+t).addClass("checked"),i.chain.color=t)})},isGLmol:function(){return"GLmol"===Model.engine},isJSmol:function(){return"JSmol"===Model.engine},isCDW:function(){return"CDW"===Model.engine},isMOL:function(){return"MOL"===Model.data.current},isPDB:function(){return"PDB"===Model.data.current},isCIF:function(){return"CIF"===Model.data.current},resize:function(){this.isGLmol()?this.GLmol.resize():this.isJSmol()?this.JSmol.resize():this.isCDW()&&this.CDW.resize()},reset:function(){this.isGLmol()?this.GLmol.reset():this.isJSmol()?this.JSmol.reset():this.isCDW()&&this.CDW.reset()},setRenderEngine:function(e,t){if(this.engine!==e){if("GLmol"===e){if(this.isCIF())return void Messages.alert("no_glmol_crystals");if(this.GLmol.ready)this._setRenderEngine(e),t&&t();else if(!this.GLmol.init(t))return}else if("JSmol"===e){if(this.JSmol.ready)this._setRenderEngine(e),t&&t();else if(!this.JSmol.init(t))return}else if("CDW"===e)if(this.CDW.ready)this._setRenderEngine(e),t&&t();else if(!this.CDW.init(t))return;$("#action-engine-glmol").removeClass("checked"),$("#action-engine-jmol").removeClass("checked"),$("#action-engine-cdw").removeClass("checked"),$("#action-engine-"+("GLmol"===e?"glmol":"JSmol"===e?"jmol":"CDW"===e?"cdw":"")).addClass("checked")}else t&&t()},_setRenderEngine:function(e){$("#glmol").css("display","GLmol"===e?"block":"none"),$("#jsmol").css("display","JSmol"===e?"block":"none"),$("#chemdoodle").css("display","CDW"===e?"block":"none"),this.engine=e,this.resize(),this.isGLmol()?this.GLmol.setBackground(this.bg.hex):this.isJSmol()?this.JSmol.setBackground(this.bg.jmol):this.isCDW()&&this.CDW.setBackground(this.bg.rgb,this.bg.html,this.fg.html),this.loadContent()||(this.isGLmol()?this.GLmol.setRepresentation():this.isJSmol()?this.JSmol.setRepresentation():this.isCDW()&&this.CDW.setRepresentation())},setRepresentation:function(e){oneOf(e,["balls","stick","vdw","wireframe","line"])&&($(".r-mode").removeClass("checked"),$("#action-model-"+e).addClass("checked"),this.representation=e,window.setTimeout(function(){this.isGLmol()?this.GLmol.setRepresentation():this.isJSmol()?this.JSmol.setRepresentation():this.isCDW()&&this.CDW.setRepresentation()}.bind(this),300))},setChainType:function(e,t){var i;oneOf(e,["ribbon","cylinders","btube","ctrace"])&&(this.isPDB()||t?this.isGLmol()||this.isJSmol()&&oneOf(e,["ribbon","ctrace","none"])||this.isCDW()&&"ribbon"===e?($(".chain-type").removeClass("checked"),$("#action-chain-type-"+e).addClass("checked"),this.chain.type=e,i=Messages.process(function(){Model.isGLmol()?Model.GLmol.setRepresentation():Model.JSmol.setRepresentation(),i&&Messages.clear()},"model_update")):Messages.alert(oneOf(e,["ribbon","ctrace","none"])?"glmol_and_jmol_only":"glmol_only"):Messages.alert("no_protein"))},setChainBonds:function(e,t){var i;this.isPDB()||t?this.isGLmol()||this.isJSmol()||this.isCDW()&&!e?($("#action-chain-type-bonds").toggleClass("checked",e),this.chain.bonds=e,i=Messages.process(function(){Model.isGLmol()?Model.GLmol.setRepresentation():Model.JSmol.setRepresentation(),i&&Messages.clear()},"model_update")):Messages.alert("glmol_and_jmol_only"):Messages.alert("no_protein")},setChainColor:function(e,t){var i;this.isPDB()||t?this.isGLmol()||this.isJSmol()||this.isCDW()&&"bfactor"!==e?($(".chain-color").removeClass("checked"),$("#action-chain-color-"+e).addClass("checked"),this.chain.color=e,i=Messages.process(function(){Model.isGLmol()?Model.GLmol.setRepresentation():Model.isJSmol()?Model.JSmol.setRepresentation():Model.CDW.setRepresentation(),i&&Messages.clear()},"model_update")):Messages.alert("glmol_and_jmol_only"):Messages.alert("no_protein")},setBackground:function(e){return Preferences.set("model","background",e),this.bg.colorName=e,this.bg.hex="white"!==e?"gray"!==e?0:13421772:16777215,this.bg.rgb=[this.bg.hex>>16,this.bg.hex>>8&255,255&this.bg.hex],this.bg.jmol="["+this.bg.rgb.join()+"]",this.bg.html="rgb("+this.bg.rgb.join()+")",this.fg.html="rgb("+(255-this.bg.rgb[0])+","+(255-this.bg.rgb[0])+","+(255-this.bg.rgb[0])+")",$(".model-bg").removeClass("checked"),$("#action-model-bg-"+e).addClass("checked"),$("#model").css("background",this.bg.html),this.isGLmol()?this.GLmol.setBackground(this.bg.hex):this.isJSmol()?this.JSmol.setBackground(this.bg.jmol):this.isCDW()?this.CDW.setBackground(this.bg.rgb,this.bg.html,this.fg.html):void 0},setBioAssembly:function(e){var t;this.isGLmol()?this.isPDB()?($("#action-bio-assembly").text(e?"Show assymetic unit":"Show bio assembly"),this.displayBU=e,t=Messages.process(function(){Model.GLmol.setAssembly(e),t&&Messages.clear()},"model_update")):Messages.alert("no_protein"):Messages.alert("glmol_only")},loadContent:function(){return this.isMOL()?this._loadMOL(this.data.mol):this.isPDB()?this._loadPDB(this.data.pdb):!!this.isCIF()&&this._loadCIF(this.data.cif)},loadMOL:function(e){this.data.current="MOL",this.data.mol=e,$("#action-export-model").text("MOL file"),$(".jmol-script").removeClass("disabled"),this._loadMOL(e)},_loadMOL:function(e){return this.isGLmol()?this.GLmol.loadMOL(e):this.isJSmol()?this.JSmol.loadMOL(e):this.isCDW()?this.CDW.loadMOL(e):void 0},loadPDB:function(e){this.data.current="PDB",this.data.pdb=e,$("#action-export-model").text("PDB file"),$(".jmol-script").addClass("disabled"),this._loadPDB(e)},preloadPDB:function(e,t){this.data.current="PDB",this.data.pdb=e,$("#action-export-model").text("PDB file"),$(".jmol-script").addClass("disabled")},_loadPDB:function(e){return this.displayBU=!1,$("#action-bio-assembly").text("Show bio assembly"),this.isGLmol()?this.GLmol.loadPDB(e):this.isJSmol()?this.JSmol.loadPDB(e):this.isCDW()?this.CDW.loadPDB(e):void 0},loadCIF:function(e,t,i){this.data.current="CIF",this.data.cif=e,$("#action-export-model").text("CIF file"),$(".jmol-script").removeClass("disabled"),$(".jmol-calc").addClass("disabled"),this._loadCIF(e,t,i)},_loadCIF:function(e,t,i){t=t||[1,1,1],this.isGLmol()?Detector.webgl?this.setRenderEngine("CDW",function(){Model.CDW.loadCIF(Model.data.cif,t),i&&i()}):this.setRenderEngine("JSmol",function(){Model.JSmol.loadCIF(Model.data.cif,t),i&&i()}):this.isJSmol()?(this.JSmol.loadCIF(e,t),i&&i()):this.isCDW()&&(Detector.webgl?(this.CDW.loadCIF(e,t),i&&i()):this.setRenderEngine("JSmol",function(){Model.JSmol.loadCIF(Model.data.cif,t),i&&i()}))},getImageDataURL:function(){var e="";return this.isGLmol()?e=this.GLmol.toDataURL():this.isJSmol()?e=this.JSmol.toDataURL():this.isCDW()&&(e=this.CDW.toDataURL()),e},getFileBlob:function(){var e;return this.isMOL()?e=new Blob([this.data.mol],{type:"chemical/x-mdl-molfile"}):this.isPDB()?e=new Blob([this.data.pdb],{type:"chemical/x-pdb"}):this.isCIF()&&(e=new Blob([this.data.cif],{type:"chemical/x-cif"})),e},getFileExstension:function(){return Model.data.current}},Request={API_ROOT:"",init:function(){},CIRsearch:function(i,s,e){""!==i?Request.CIR.resolve(i,!1,function(t){Progress.increment(),Request.CIR.resolve(i,!0,function(e){s(e,t,i)},e)},e):e()},CIRsearch3D:function(t,i,s){""!==t?Request.CIR.resolve(t,!1,function(e){Progress.increment(),i(e,t)},function(){Progress.increment(),Request.translation(t,function(e){Progress.increment(),t=e,Request.CIR.resolve(t,!1,function(e){i(e,t)},s)})},s):s()},resolve:function(e,t,i,s,o){function r(t){0<t?Request.PubChem.sdf(t,i,function(e){s(e,t)},function(){Progress.increment(),Request.CIR.resolve(e,i,function(e){s(e,i?-1:t)},o)}):Request.CIR.resolve(e,i,function(e){s(e,-1)},o)}0===t?Request.PubChem.smilesToCID(e,function(e){Progress.increment(),r(e)},function(){Progress.increment(),r(-1)}):r(t)},CIR:{available:!1,resolve:function(e,t,i,s){Request.CIR.available?AJAX({primary:!0,dataType:"text",url:"https://cactus.nci.nih.gov/chemical/structure/"+(e=e.replace(/#/g,"%23").replace(/\\/g,"%5C"))+"/file?format=sdf&get3d="+(t?"False":"True"),defaultError:s,success:function(e){"<h1>Page not found (404)</h1>\n"===e||void 0===e?s():i(e)}}):s()},property:function(e,s,o,r){Request.CIR.available?AJAX({dataType:"text",url:"https://cactus.nci.nih.gov/chemical/structure/"+(e=e.replace(/#/g,"%23").replace(/\\/g,"%5C"))+"/"+s,defaultError:r,success:function(e){var t,i;"<h1>Page not found (404)</h1>\n"===e||void 0===e?r&&r():(i=(t=e.split("\n"))[0],"cas"===s?(t.sort(function(e,t){return e.length-t.length}),i=t[0]):"stdinchikey"===s&&(i=i.substr(9)),o(i))}}):r()}},PubChem:{data:[],maxRecords:50,MaxSeconds:10,search:function(e,t,i){""!==e?(Progress.increment(),AJAX({primary:!0,dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/"+encodeURIComponent(e)+"/cids/json?name_type=word",defaultError:i,success:function(e){Progress.increment(),Request.PubChem.data=e.IdentifierList.CID,t()}})):i&&i()},structureSearch:function(e,t,i,s,o){AJAX({primary:!0,dataType:"json",url:"smiles"===e?"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/"+i+"/"+e+"/json?"+e+"="+encodeURIComponent(t)+"&MaxRecords="+Request.PubChem.maxRecords+"&MaxSeconds="+Request.PubChem.MaxSeconds:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/"+i+"/"+e+"/"+t+"/json?MaxRecords="+Request.PubChem.maxRecords+"&MaxSeconds="+Request.PubChem.MaxSeconds,defaultError:o,success:function(e){s(e.Waiting.ListKey)}})},list:function(e,t,i,s){AJAX({primary:!0,dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/listkey/"+e+"/cids/json",defaultError:s,success:function(e){e.IdentifierList?(Request.PubChem.data=e.IdentifierList.CID,t()):e.Waiting?i(e.Waiting.ListKey):e.Fault&&s&&s()}})},smilesToCID:function(e,t,i){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/cids/json?smiles="+encodeURIComponent(e),defaultError:i,success:function(e){e.IdentifierList&&0<e.IdentifierList.CID[0]?t(e.IdentifierList.CID[0]):i()}})},nameToCID:function(e,t,i){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/"+e+"/cids/json",defaultError:i,success:function(e){e.IdentifierList?t(e.IdentifierList.CID[0]):i()}})},primaryName:function(e,t,i){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/"+e+"/description/json",defaultError:i,success:function(e){e.InformationList?t(e.InformationList.Information[0].Title):i&&i()}})},description:function(e,t,i){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/description/json",defaultError:i,success:t})},properties:function(e,t,i,s){AJAX({dataType:"json",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/property/"+t+"/json",defaultError:s,success:i})},casNumber:function(e,o,r){AJAX({dataType:"text",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/synonyms/txt",defaultError:r,success:function(e){for(var t=/^\d{2,7}-\d{2}-\d$/gm,i=[],s={};null!==(s=t.exec(e));)i.push(s[0]);0<i.length?(i.sort(function(e,t){return e.length-t.length}),o(i[0])):r()}})},image:function(e,t){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/png?record_type=2d&image_size="+(Math.round(t)||300)*MolView.devicePixelRatio+"x"+(Math.round(t)||300)*MolView.devicePixelRatio},smilesToImage:function(e){return"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/png?record_type=2d&smiles="+encodeURIComponent(e)+"&image_size="+300*MolView.devicePixelRatio+"x"+300*MolView.devicePixelRatio},sdf:function(e,t,i,s){AJAX({primary:!0,dataType:"text",url:"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/sdf?record_type="+(t?"2d":"3d"),defaultError:s,success:i})},staticURL:function(e){return"https://pubchem.ncbi.nlm.nih.gov/compound/"+e}},RCSB:{data:[],search:function(e,t,i){""!==e?(Progress.increment(),AJAX({primary:!0,type:"POST",data:"<orgPdbQuery><queryType>org.pdb.query.simple.AdvancedKeywordQuery</queryType><description>Text search for: "+(e=e.replace(/\s/g,"|"))+"(molview.org)</description><keywords>"+e+"</keywords></orgPdbQuery>",contentType:"application/x-www-form-urlencoded",dataType:"text",url:"https://www.rcsb.org/pdb/rest/search?sortfield=rank",defaultError:i,success:function(e){Progress.increment(),Request.RCSB.data=e.split(/\n/),Request.RCSB.data=Request.RCSB.data.filter(function(e){return""!==e}),Request.RCSB.data.reverse(),0<Request.RCSB.data.length?t():i&&i()}})):i&&i()},information:function(n,a,e){AJAX({primary:!0,dataType:"text",url:"https://www.rcsb.org/pdb/rest/customReport?pdbids="+n.join()+"&customReportColumns=structureId,structureTitle",defaultError:e,success:function(e){for(var t={dataset:[]},i=[],s=$(e).find("record"),o=0;o<s.length;o++)i.push({structureId:$(s[o]).find("dimStructure\\.structureId").text(),structureTitle:$(s[o]).find("dimStructure\\.structureTitle").text()});for(o=0;o<n.length;o++)for(var r=0;r<i.length;r++)i[r].structureId!==n[o]||t.dataset.push(i[r]);a(t)}})},image:function(e){return"https://www.rcsb.org/pdb/images/"+e+"_bio_r_500.jpg"},PDB:function(e,t,i){AJAX({primary:!0,dataType:"text",url:"https://files.rcsb.org/view/"+e+".pdb",defaultError:i,success:t})},staticURL:function(e){return"http://www.rcsb.org/pdb/explore/explore.do?structureId="+e}},COD:{data:{records:[]},search:function(e,t,i){""!==e?(Progress.increment(),AJAX({primary:!0,dataType:"json",url:Request.API_ROOT+"api/cod/search/"+encodeURIComponent(e),defaultError:i,success:function(e){Progress.increment(),e.error?i&&i(!0):e.records&&0<e.records.length?(Request.COD.data=e.records,t()):i&&i(!1)}})):i&&i()},smiles:function(e,t,i){AJAX({primary:!0,dataType:"json",url:Request.API_ROOT+"api/cod/smiles/"+e,defaultError:i,success:t})},name:function(e,t,i){AJAX({primary:!0,dataType:"json",url:Request.API_ROOT+"api/cod/name/"+e,defaultError:i,success:t})},CIF:function(e,t,i){AJAX({primary:!0,dataType:"text",url:"https://molview.org/api/cod/cif/"+e+".cif",defaultError:i,success:t})},staticURL:function(e){return"http://www.crystallography.net/"+e+".html"}},NMRdb:{prediction:function(e,t,i){AJAX({dataType:"json",url:"http://www.nmrdb.org/service/prediction?smiles="+encodeURIComponent(e),defaultError:i,success:function(e){t(e.jcamp.value)}})}},NIST:{lookup:function(e,o,t){AJAX({dataType:"json",url:Request.API_ROOT+"api/nist/lookup/"+e,defaultError:t,success:function(e){var t=[];t.url=e.url,t.mass=e.mass,t.uvvis=e.uvvis,t.ir=new Array,e.ir.sort(function(e,t){return e.i-t.i});for(var i,s=0;s<e.ir.length;s++){-1===e.ir[s].source.indexOf("NO SPECTRUM")&&(i=humanize(e.ir[s].state),t.ir.push({i:e.ir[s].i,state:i}))}o(t)}})},spectrum:function(e,t,i,s){var o=-1;-1!==t.indexOf("ir")&&(o=parseInt(t.substr(3)),t="ir"),AJAX({dataType:"text",url:Request.API_ROOT+"api/nist/"+t+"/"+e+(-1!==o?"/"+o:""),defaultError:s,success:i})}}};